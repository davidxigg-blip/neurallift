<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymTrack Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signInAnonymously, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Exportamos a la ventana global para que React pueda usarlos
        window.FB = { initializeApp, getAuth, onAuthStateChanged, signInWithEmailAndPassword, signInAnonymously, signOut, getFirestore, collection, onSnapshot };
    </script>

    <style>
        body { background-color: #050505; color: #f4f4f5; margin: 0; font-family: sans-serif; }
        .glass { background: rgba(24, 24, 27, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(63, 63, 70, 0.4); }
        .lime-shadow { shadow-lg shadow-lime-400/20; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyB5TTnMn1co3GA_oX3jrZ5KZ8KzRbXbhGQ",
            authDomain: "gym-pro-4588d.firebaseapp.com",
            projectId: "gym-pro-4588d",
            storageBucket: "gym-pro-4588d.firebasestorage.app",
            messagingSenderId: "177629353240",
            appId: "1:177629353240:web:3a7b3f73d05c9468347a6d"
        };

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [fbReady, setFbReady] = useState(false);

            // 1. Esperar a que Firebase cargue en el objeto Global
            useEffect(() => {
                const checkFB = setInterval(() => {
                    if (window.FB) {
                        clearInterval(checkFB);
                        window.FB.initializeApp(firebaseConfig);
                        setFbReady(true);
                    }
                }, 100);
            }, []);

            // 2. Manejar Auth una vez que FB está listo
            useEffect(() => {
                if (!fbReady) return;
                const auth = window.FB.getAuth();
                const unsub = window.FB.onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setLoading(false);
                    setTimeout(() => lucide.createIcons(), 100);
                });
                return () => unsub();
            }, [fbReady]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-[#050505]">
                    <div className="w-12 h-12 border-4 border-lime-400 border-t-transparent rounded-full animate-spin"></div>
                    <p className="mt-4 font-black italic text-zinc-500 text-xs tracking-widest">INICIALIZANDO...</p>
                </div>
            );

            if (!user) return <AuthScreen />;

            return (
                <div className="max-w-md mx-auto min-h-screen relative p-6">
                    <nav className="flex justify-between items-center mb-10">
                        <div className="flex items-center gap-2">
                            <div className="bg-lime-400 p-2 rounded-lg text-black">
                                <i data-lucide="zap"></i>
                            </div>
                            <h1 className="font-black italic text-2xl tracking-tighter">GYMTRACK</h1>
                        </div>
                        <button onClick={() => window.FB.signOut(window.FB.getAuth())} className="text-zinc-500">
                             <i data-lucide="log-out"></i>
                        </button>
                    </nav>

                    <div className="space-y-4">
                        <div className="glass p-6 rounded-[2rem]">
                            <h2 className="text-lime-400 font-black italic uppercase text-sm mb-1">Bienvenido</h2>
                            <p className="text-xl font-bold">{user.email || "Atleta Invitado"}</p>
                        </div>
                        
                        <button className="w-full bg-lime-400 text-black p-5 rounded-[2rem] font-black italic text-lg flex items-center justify-center gap-2">
                            <i data-lucide="plus-circle"></i> NUEVO ENTRENAMIENTO
                        </button>
                    </div>

                    <footer className="fixed bottom-6 left-6 right-6 glass rounded-full p-2 flex justify-around">
                        <button className="p-4 text-lime-400"><i data-lucide="layout-dashboard"></i></button>
                        <button className="p-4 text-zinc-500"><i data-lucide="history"></i></button>
                        <button className="p-4 text-zinc-500"><i data-lucide="settings"></i></button>
                    </footer>
                </div>
            );
        }

        function AuthScreen() {
            const [email, setEmail] = useState('');
            const [pass, setPass] = useState('');

            const login = () => {
                const auth = window.FB.getAuth();
                window.FB.signInWithEmailAndPassword(auth, email, pass).catch(err => alert("Error: " + err.message));
            };

            const guest = () => {
                const auth = window.FB.getAuth();
                window.FB.signInAnonymously(auth);
            };

            return (
                <div className="h-screen flex items-center justify-center p-6">
                    <div className="glass w-full p-8 rounded-[3rem] space-y-6">
                        <div className="text-center">
                            <h2 className="text-3xl font-black italic tracking-tighter uppercase">GYMTRACK</h2>
                            <p className="text-[10px] text-zinc-500 font-bold tracking-widest mt-1">PRO VERSION</p>
                        </div>
                        <div className="space-y-3">
                            <input className="w-full bg-zinc-900/50 border border-zinc-800 p-4 rounded-2xl outline-none focus:border-lime-400 transition-all" placeholder="Email" onChange={e => setEmail(e.target.value)} />
                            <input className="w-full bg-zinc-900/50 border border-zinc-800 p-4 rounded-2xl outline-none focus:border-lime-400 transition-all" type="password" placeholder="Contraseña" onChange={e => setPass(e.target.value)} />
                        </div>
                        <button onClick={login} className="w-full bg-lime-400 text-black p-4 rounded-2xl font-black italic text-lg">ACCEDER</button>
                        <button onClick={guest} className="w-full text-zinc-500 text-[10px] font-black uppercase tracking-widest text-center">Entrar como invitado</button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
